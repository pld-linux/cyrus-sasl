--- cyrus-sasl-2.1.23/cmulocal/sasl2.m4.orig	2010-10-04 01:53:48.000000000 +0200
+++ cyrus-sasl-2.1.23/cmulocal/sasl2.m4	2010-10-04 02:05:55.252144435 +0200
@@ -217,11 +217,25 @@
   elif test "$ac_cv_header_gssapi_h" = "yes"; then
     AC_EGREP_HEADER(GSS_C_NT_HOSTBASED_SERVICE, gssapi.h,
                     [AC_DEFINE(HAVE_GSS_C_NT_HOSTBASED_SERVICE,,
-                               [Define if your GSSAPI implimentation defines GSS_C_NT_HOSTBASED_SERVICE])])
+                               [Define if your GSSAPI implimentation defines GSS_C_NT_HOSTBASED_SERVICE])],
+                    [AC_EGREP_CPP(hostbased_service_gss_nt_yes,
+                                  [#include <gssapi.h>
+                                   #ifdef GSS_C_NT_HOSTBASED_SERVICE
+                                     hostbased_service_gss_nt_yes
+                                   #endif],
+                                   [AC_DEFINE(HAVE_GSS_C_NT_HOSTBASED_SERVICE,,
+                                              [Define if your GSSAPI implimentation defines GSS_C_NT_HOSTBASED_SERVICE])])])
   elif test "$ac_cv_header_gssapi_gssapi_h"; then
     AC_EGREP_HEADER(GSS_C_NT_HOSTBASED_SERVICE, gssapi/gssapi.h,
                     [AC_DEFINE(HAVE_GSS_C_NT_HOSTBASED_SERVICE,,
-                               [Define if your GSSAPI implimentation defines GSS_C_NT_HOSTBASED_SERVICE])])
+                               [Define if your GSSAPI implimentation defines GSS_C_NT_HOSTBASED_SERVICE])],
+                    [AC_EGREP_CPP(hostbased_service_gss_nt_yes,
+                                  [#include <gssapi/gssapi.h>
+                                   #ifdef GSS_C_NT_HOSTBASED_SERVICE
+                                     hostbased_service_gss_nt_yes
+                                   #endif],
+                                   [AC_DEFINE(HAVE_GSS_C_NT_HOSTBASED_SERVICE,,
+                                              [Define if your GSSAPI implimentation defines GSS_C_NT_HOSTBASED_SERVICE])])])
   fi
 
   if test "$gss_impl" = "cybersafe" -o "$gss_impl" = "cybersafe03"; then
@@ -236,11 +244,25 @@
   elif test "$ac_cv_header_gssapi_h" = "yes"; then
     AC_EGREP_HEADER(GSS_C_NT_USER_NAME, gssapi.h,
                     [AC_DEFINE(HAVE_GSS_C_NT_USER_NAME,,
-                               [Define if your GSSAPI implimentation defines GSS_C_NT_USER_NAME])])
+                               [Define if your GSSAPI implimentation defines GSS_C_NT_USER_NAME])],
+                    [AC_EGREP_CPP(user_name_yes_gss_nt,
+                                  [#include <gssapi.h>
+                                   #ifdef GSS_C_NT_USER_NAME
+                                     user_name_yes_gss_nt
+                                   #endif],
+                                   [AC_DEFINE(HAVE_GSS_C_NT_USER_NAME,,
+                                              [Define if your GSSAPI implimentation defines GSS_C_NT_USER_NAME])])])
   elif test "$ac_cv_header_gssapi_gssapi_h"; then
     AC_EGREP_HEADER(GSS_C_NT_USER_NAME, gssapi/gssapi.h,
                     [AC_DEFINE(HAVE_GSS_C_NT_USER_NAME,,
-                               [Define if your GSSAPI implimentation defines GSS_C_NT_USER_NAME])])
+                               [Define if your GSSAPI implimentation defines GSS_C_NT_USER_NAME])],
+                    [AC_EGREP_CPP(user_name_yes_gss_nt,
+                                  [#include <gssapi/gssapi.h>
+                                   #ifdef GSS_C_NT_USER_NAME
+                                     user_name_yes_gss_nt
+                                   #endif],
+                                   [AC_DEFINE(HAVE_GSS_C_NT_USER_NAME,,
+                                              [Define if your GSSAPI implimentation defines GSS_C_NT_USER_NAME])])])
   fi
 fi
 
